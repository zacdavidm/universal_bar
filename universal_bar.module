<?php

function curPageURL() {
 $pageURL = 'http';
 if (isset($_SERVER["HTTPS"]) && $_SERVER["HTTPS"]== "on") {$pageURL .= "s";}
 $pageURL .= "://";
 if ($_SERVER["SERVER_PORT"] != "80") {
  $pageURL .= $_SERVER["SERVER_NAME"].":".$_SERVER["SERVER_PORT"].$_SERVER["REQUEST_URI"];
 } else {
  $pageURL .= $_SERVER["SERVER_NAME"].$_SERVER["REQUEST_URI"];
 }
 return $pageURL;
}
function universal_bar_page_alter(&$page){
	$mod_path="/".drupal_get_path('module', 'universal_bar');

	$account_in_out;
	$account_user="";
	$feedback_ref=urlencode(curPageURL());
	if(user_is_logged_in()){
		$account_user='<li>'.l(t('Account'), 'https://forgoodaccounts.pairsite.com/user').'</li>';
		$account_in_out=l(t('Sign Out'), 'caslogout', array('query' => drupal_get_destination()));
	}else{
		$account_user='<li>'.l(t('Create Account'), 'https://forgoodaccounts.pairsite.com/user/register', array('attributes' => array('class' => array('button', 'small')))).'</li>';
		$account_in_out=l(t('Sign In'), 'cas', array('query' => drupal_get_destination()));
	}
	$sites_list='
	<div class="display-panel">
		<ul class="sites-list small-block-grid-3 menu">
			<li>
        <a title="Forgood Studios" href="http://forgoodstudios.org">
          <img src="'.$mod_path.'/images/studios.png" alt="Forgood Studios" />
          <span>Forgood Studios</span>
        </a>
      </li>
			<li>
        <a title="Housing" href="http://housing.forgoodstudios.org">
          <img src="'.$mod_path.'/images/housing.png" alt="Forgood Housing" />
          <span>Housing</span>
        </a>
      </li>
			<li>
        <a title="Forgood Ideas" href="http://reddit.com/r/forgoodideas">
          <img src="'.$mod_path.'/images/ideas.png" alt="Forgood Ideas" />
          <span>Ideas</span>
        </a>
      </li>
			<li>
        <a title="Forgood Accounts" href="http://forgoodaccounts.pairsite.com">
          <img src="'.$mod_path.'/images/accounts.png" alt="Forgood Accounts" />
          <span>Accounts</span>
        </a>
      </li>
			<li>
        <a title="Redjacket Arts" href="http://redjacketarts.com">
          <img src="'.$mod_path.'/images/redjacket.png" alt="Redjacket Arts" />
          <span>Redjacket Arts</span>
        </a>
      </li>
		</ul>
		<div class="display-panel-footer">
			<a href="https://forgoodaccounts.pairsite.com/site-descriptions">Site Descriptions</a>
		</div>
	</div>';
	$notifications=
	'<div class="display-panel">
	<div id="notifications"></div>
	<div class="display-panel-footer">
		<a href="https://forgoodaccounts.pairsite.com/notifications">Notifications Manager</a>
	</div>
	</div>';
    $page['page_top']['universal_bar']=array(
    '#markup'=>
    '<div class="universal-bar">
		<div class="row">
			<div class="right">
				<ul class="menu inline-list">
					'.$account_user.'
					<li id="toggle-sites-list"><a title="Sites"><i class="fa fa-th"><span class="element-invisible">Sites</span></i></a>
						'.$sites_list.'
					</li>
					<!--li id="toggle-notifications"><a title="Notifications"><i class="fa fa-bell"><span class="element-invisible">Notifications</span></i><span class="notif-count"></span></a>
						'.$notifications.'
					</li-->
					<li><a href="https://forgoodaccounts.pairsite.com/feedback?ref='.$feedback_ref.'" title="Feedback"><i class="fa fa-question-circle"><span class="element-invisible">Feedback</span></i></a>
						'.$notifications.'
					</li>
					<li>'.$account_in_out.'</li>
				</ul>
			</div>
		</div>
    </div>',
    '#weight' => 26,
    );

}
